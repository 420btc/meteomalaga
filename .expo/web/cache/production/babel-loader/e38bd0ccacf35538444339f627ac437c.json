{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}import AsyncStorage from'@react-native-async-storage/async-storage';import{fetchCurrentTemperatureData,fetchCurrentRainData}from\"./weatherService\";var ALERTS_STORAGE_KEY='user_weather_alerts';export var createAlert=function(){var _ref=_asyncToGenerator(function*(alert){try{var id=Date.now().toString();var newAlert=_objectSpread(_objectSpread({},alert),{},{id:id,createdAt:new Date().toISOString()});var existingAlerts=yield getAlerts();var updatedAlerts=[].concat(_toConsumableArray(existingAlerts),[newAlert]);yield AsyncStorage.setItem(ALERTS_STORAGE_KEY,JSON.stringify(updatedAlerts));return newAlert;}catch(error){console.error('Error creating alert:',error);throw new Error('Failed to create alert');}});return function createAlert(_x){return _ref.apply(this,arguments);};}();export var getAlerts=function(){var _ref2=_asyncToGenerator(function*(){try{var alertsJson=yield AsyncStorage.getItem(ALERTS_STORAGE_KEY);if(!alertsJson){return[];}return JSON.parse(alertsJson);}catch(error){console.error('Error getting alerts:',error);return[];}});return function getAlerts(){return _ref2.apply(this,arguments);};}();export var updateAlert=function(){var _ref3=_asyncToGenerator(function*(updatedAlert){try{var alerts=yield getAlerts();var updatedAlerts=alerts.map(function(alert){return alert.id===updatedAlert.id?updatedAlert:alert;});yield AsyncStorage.setItem(ALERTS_STORAGE_KEY,JSON.stringify(updatedAlerts));return updatedAlert;}catch(error){console.error('Error updating alert:',error);throw new Error('Failed to update alert');}});return function updateAlert(_x2){return _ref3.apply(this,arguments);};}();export var deleteAlert=function(){var _ref4=_asyncToGenerator(function*(alertId){try{var alerts=yield getAlerts();var filteredAlerts=alerts.filter(function(alert){return alert.id!==alertId;});yield AsyncStorage.setItem(ALERTS_STORAGE_KEY,JSON.stringify(filteredAlerts));}catch(error){console.error('Error deleting alert:',error);throw new Error('Failed to delete alert');}});return function deleteAlert(_x3){return _ref4.apply(this,arguments);};}();export var toggleAlertActive=function(){var _ref5=_asyncToGenerator(function*(alertId){try{var alerts=yield getAlerts();var alert=alerts.find(function(a){return a.id===alertId;});if(!alert){throw new Error('Alert not found');}var updatedAlert=_objectSpread(_objectSpread({},alert),{},{active:!alert.active});return yield updateAlert(updatedAlert);}catch(error){console.error('Error toggling alert:',error);throw new Error('Failed to toggle alert');}});return function toggleAlertActive(_x4){return _ref5.apply(this,arguments);};}();export var checkAlerts=function(){var _ref6=_asyncToGenerator(function*(){try{var alerts=yield getAlerts();var activeAlerts=alerts.filter(function(alert){return alert.active;});if(activeAlerts.length===0){return[];}var temperatureData=yield fetchCurrentTemperatureData();var rainData=yield fetchCurrentRainData();var results=[];for(var alert of activeAlerts){var triggered=false;var currentValue=0;if(alert.type==='temperature'){currentValue=temperatureData.current;if(alert.condition==='above'&&currentValue>alert.threshold){triggered=true;}else if(alert.condition==='below'&&currentValue<alert.threshold){triggered=true;}else if(alert.condition==='equals'&&Math.abs(currentValue-alert.threshold)<0.5){triggered=true;}}else if(alert.type==='rain'){currentValue=rainData;if(alert.condition==='above'&&currentValue>alert.threshold){triggered=true;}else if(alert.condition==='below'&&currentValue<alert.threshold){triggered=true;}else if(alert.condition==='equals'&&Math.abs(currentValue-alert.threshold)<0.5){triggered=true;}}results.push({triggered:triggered,alert:alert,currentValue:currentValue});}return results;}catch(error){console.error('Error checking alerts:',error);return[];}});return function checkAlerts(){return _ref6.apply(this,arguments);};}();","map":{"version":3,"names":["AsyncStorage","fetchCurrentTemperatureData","fetchCurrentRainData","ALERTS_STORAGE_KEY","createAlert","_ref","_asyncToGenerator","alert","id","Date","now","toString","newAlert","_objectSpread","createdAt","toISOString","existingAlerts","getAlerts","updatedAlerts","concat","_toConsumableArray","setItem","JSON","stringify","error","console","Error","_x","apply","arguments","_ref2","alertsJson","getItem","parse","updateAlert","_ref3","updatedAlert","alerts","map","_x2","deleteAlert","_ref4","alertId","filteredAlerts","filter","_x3","toggleAlertActive","_ref5","find","a","active","_x4","checkAlerts","_ref6","activeAlerts","length","temperatureData","rainData","results","triggered","currentValue","type","current","condition","threshold","Math","abs","push"],"sources":["/Users/atemjohnatem/Downloads/meteo-malaga/src/services/alertService.ts"],"sourcesContent":["import AsyncStorage from '@react-native-async-storage/async-storage';\nimport { UserAlert, AlertCheckResult } from '../types/alerts';\nimport { fetchCurrentTemperatureData, fetchCurrentRainData } from './weatherService';\n\nconst ALERTS_STORAGE_KEY = 'user_weather_alerts';\n\n// Create a new alert\nexport const createAlert = async (alert: Omit<UserAlert, 'id' | 'createdAt'>): Promise<UserAlert> => {\n  try {\n    // Generate a unique ID\n    const id = Date.now().toString();\n    \n    // Create the complete alert object\n    const newAlert: UserAlert = {\n      ...alert,\n      id,\n      createdAt: new Date().toISOString(),\n    };\n    \n    // Get existing alerts\n    const existingAlerts = await getAlerts();\n    \n    // Add the new alert\n    const updatedAlerts = [...existingAlerts, newAlert];\n    \n    // Save to storage\n    await AsyncStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(updatedAlerts));\n    \n    return newAlert;\n  } catch (error) {\n    console.error('Error creating alert:', error);\n    throw new Error('Failed to create alert');\n  }\n};\n\n// Get all alerts\nexport const getAlerts = async (): Promise<UserAlert[]> => {\n  try {\n    const alertsJson = await AsyncStorage.getItem(ALERTS_STORAGE_KEY);\n    \n    if (!alertsJson) {\n      return [];\n    }\n    \n    return JSON.parse(alertsJson);\n  } catch (error) {\n    console.error('Error getting alerts:', error);\n    return [];\n  }\n};\n\n// Update an alert\nexport const updateAlert = async (updatedAlert: UserAlert): Promise<UserAlert> => {\n  try {\n    const alerts = await getAlerts();\n    \n    const updatedAlerts = alerts.map(alert => \n      alert.id === updatedAlert.id ? updatedAlert : alert\n    );\n    \n    await AsyncStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(updatedAlerts));\n    \n    return updatedAlert;\n  } catch (error) {\n    console.error('Error updating alert:', error);\n    throw new Error('Failed to update alert');\n  }\n};\n\n// Delete an alert\nexport const deleteAlert = async (alertId: string): Promise<void> => {\n  try {\n    const alerts = await getAlerts();\n    \n    const filteredAlerts = alerts.filter(alert => alert.id !== alertId);\n    \n    await AsyncStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(filteredAlerts));\n  } catch (error) {\n    console.error('Error deleting alert:', error);\n    throw new Error('Failed to delete alert');\n  }\n};\n\n// Toggle alert active status\nexport const toggleAlertActive = async (alertId: string): Promise<UserAlert> => {\n  try {\n    const alerts = await getAlerts();\n    \n    const alert = alerts.find(a => a.id === alertId);\n    \n    if (!alert) {\n      throw new Error('Alert not found');\n    }\n    \n    const updatedAlert = {\n      ...alert,\n      active: !alert.active\n    };\n    \n    return await updateAlert(updatedAlert);\n  } catch (error) {\n    console.error('Error toggling alert:', error);\n    throw new Error('Failed to toggle alert');\n  }\n};\n\n// Check if any alerts are triggered based on current weather data\nexport const checkAlerts = async (): Promise<AlertCheckResult[]> => {\n  try {\n    const alerts = await getAlerts();\n    const activeAlerts = alerts.filter(alert => alert.active);\n    \n    if (activeAlerts.length === 0) {\n      return [];\n    }\n    \n    // Fetch current weather data\n    const temperatureData = await fetchCurrentTemperatureData();\n    const rainData = await fetchCurrentRainData();\n    \n    // Check each alert\n    const results: AlertCheckResult[] = [];\n    \n    for (const alert of activeAlerts) {\n      let triggered = false;\n      let currentValue = 0;\n      \n      if (alert.type === 'temperature') {\n        currentValue = temperatureData.current;\n        \n        if (alert.condition === 'above' && currentValue > alert.threshold) {\n          triggered = true;\n        } else if (alert.condition === 'below' && currentValue < alert.threshold) {\n          triggered = true;\n        } else if (alert.condition === 'equals' && Math.abs(currentValue - alert.threshold) < 0.5) {\n          triggered = true;\n        }\n      } else if (alert.type === 'rain') {\n        currentValue = rainData;\n        \n        if (alert.condition === 'above' && currentValue > alert.threshold) {\n          triggered = true;\n        } else if (alert.condition === 'below' && currentValue < alert.threshold) {\n          triggered = true;\n        } else if (alert.condition === 'equals' && Math.abs(currentValue - alert.threshold) < 0.5) {\n          triggered = true;\n        }\n      }\n      \n      results.push({\n        triggered,\n        alert,\n        currentValue\n      });\n    }\n    \n    return results;\n  } catch (error) {\n    console.error('Error checking alerts:', error);\n    return [];\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}